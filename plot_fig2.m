% fig 2
clear all
close all
restoredefaultpath;

addpath ./utility/cmocean/
addpath ./utility/
addpath ./1Dmodel/
addpath ./utility/export_fig/

figure('Position',[100 100 1500 525]);

load('sweep_trans_default.mat','Smaster')
ibn=10;
Soutmat=Smaster{ibn}.Soutmat;
toutmat=Smaster{ibn}.toutmat;
bgcparams=Smaster{ibn}.bgcparams;
NEW_PRODUCTION =...
    360./1000.*86400.*bgcparams.mum./(bgcparams.kz).*...
    log((bgcparams.kI+Ifn(bgcparams.latlight,mod(toutmat./86400,360)))./bgcparams.kI).* ...
    (squeeze(Soutmat(1,1,:))./(bgcparams.kN+squeeze(Soutmat(1,1,:))))';


subplot(1,2,1),...
    Nyear=round(3.1104e7/(toutmat(2)-toutmat(1)));
plot(toutmat./(86400.*360),smooth(NEW_PRODUCTION,Nyear),'k-','linewidth',1);
hold on
xlim([0 80])
ylim([0 1])
grid on
xlabel('Year','fontsize',12)
ylabel('(mol N/m^2/yr)','fontsize',12);
set(gcf,'color','w')


subplot(1,2,2),...
    hold on
    plot(mod(toutmat(end-40:end)./(86400),360),NEW_PRODUCTION(end-40:end),'k-','linewidth',1);
hold on;
    plot(mod(toutmat(1:41)./(86400),360),NEW_PRODUCTION(1:41),'-','color',[.6 .6 .6],'linewidth',1);

title('Seasonal cycles: present and future','fontsize',12,'fontweight','normal');
xlabel('Day of the year','fontsize',12)
ylabel('(mol N/m^2/yr)','fontsize',12)
grid on


annotation(gcf,'textarrow',[0.740972222222222 0.676388888888889],...
    [0.626666666666667 0.512380952380952],...
    'String',{'reduced overturning & mixing'},...
    'LineWidth',1,...
    'FontSize',16,...
    'FontName','Helvetica Neue');
annotation(gcf,'textarrow',[0.743055555555556 0.677083333333333],...
    [0.71047619047619 0.610095238095238],'String',{'reduced overturning'},...
    'LineWidth',1,...
    'FontSize',16,...
    'FontName','Helvetica Neue');
annotation(gcf,'textarrow',[0.728472222222222 0.683333333333333],...
    [0.780952380952381 0.691428571428571],...
    'String',{'reduced wintertime vertical mixing'},...
    'LineWidth',1,...
    'FontSize',16,...
    'FontName','Helvetica Neue');

clear Smaster PROD NEW_PRODUCTION toutmat Soutmat bgcparams
load('sweep_trans_PSIonly.mat','Smaster')
ibn=10;
Soutmat=Smaster{ibn}.Soutmat;
toutmat=Smaster{ibn}.toutmat;
bgcparams=Smaster{ibn}.bgcparams;
NEW_PRODUCTION =...
    360./1000.*86400.*bgcparams.mum./(bgcparams.kz).*...
    log((bgcparams.kI+Ifn(bgcparams.latlight,mod(toutmat./86400,360)))./bgcparams.kI).* ...
    (squeeze(Soutmat(1,1,:))./(bgcparams.kN+squeeze(Soutmat(1,1,:))))';


subplot(1,2,1),...
    hold on
plot(toutmat./(86400.*360),smooth(NEW_PRODUCTION,Nyear),'k--','linewidth',1);
hold on


subplot(1,2,2),...
hold on
    plot(mod(toutmat(end-40:end)./(86400),360),NEW_PRODUCTION(end-40:end),'k--','linewidth',1);
hold on;


clear Smaster bgcparams Soutmat NEW_PRODUCTION 
load('sweep_trans_MLDonly.mat','Smaster')
ibn=10;
Soutmat=Smaster{ibn}.Soutmat;
toutmat=Smaster{ibn}.toutmat;
bgcparams=Smaster{ibn}.bgcparams;
NEW_PRODUCTION =...
    360./1000.*86400.*bgcparams.mum./(bgcparams.kz).*...
    log((bgcparams.kI+Ifn(bgcparams.latlight,mod(toutmat./86400,360)))./bgcparams.kI).* ...
    (squeeze(Soutmat(1,1,:))./(bgcparams.kN+squeeze(Soutmat(1,1,:))))';

subplot(1,2,1),...
    hold on
plot(toutmat./(86400.*360),smooth(NEW_PRODUCTION,Nyear),'k-.','linewidth',1);
hold on

set(gca,'fontsize',16)
set(gca,'linewidth',1)
annotation(gcf,'textarrow',[0.406944444444445 0.432638888888889],...
    [0.750476190476191 0.676190476190476],...
    'String',{'declining wintertime vertical mixing'},...
    'LineWidth',1,...
    'FontSize',16,...
    'FontName','Helvetica Neue');
annotation(gcf,'textarrow',[0.410416666666667 0.443055555555556],...
    [0.641904761904762 0.561904761904762],'String',{'declining overturning'},...
    'LineWidth',1,...
    'FontSize',16,...
    'FontName','Helvetica Neue');
annotation(gcf,'textarrow',[0.427083333333334 0.452361111111111],...
    [0.394285714285714 0.455238095238095],...
    'String',{'declining overturning and vertical mixing'},...
    'LineWidth',1,...
    'FontSize',16,...
    'FontName','Helvetica Neue');

title('Declining subarctic new production in a global-warming scenario','fontweight','normal')

xlim([2 78])


subplot(1,2,2),...
    plot(mod(toutmat(end-40:end)./(86400),360),NEW_PRODUCTION(end-40:end),'k-.','linewidth',1);
ylim([0 2])
set(gca,'fontsize',16)
set(gcf,'color','w')
set(gca,'linewidth',1)
hold on
xlim([0 360])

annotation(gcf,'textbox',...
    [0.603083333333335 0.683809523809524 0.0753888888888882 0.059047619047619],...
    'String','Present-day scenario',...
    'LineStyle','none',...
    'FontSize',16,...
    'FontName','Helvetica Neue',...
    'FitBoxToText','off');
annotation(gcf,'arrow',[0.624305555555556 0.65],...
    [0.662857142857143 0.630476190476191],'LineWidth',1);
